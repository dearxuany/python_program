# 脚本背景</br>
使用 jmap 生成 java 进程 javadump 二进制文件，用于分析 java 系统的 jvm 内存使用状况；</br>
一般情况下，生成的 javadump 二进制文件较大且不易切割解析，故需压缩发送；</br>
压缩完毕后，压缩文件依然会有 1GB 以上大小，从阿里云生产网络传输回本地内网需占用生产带宽，故须在深夜用户量较少时传输。</br>

# 脚本结构</br>
获取 java 进程当前 pid 及用户 - 根据当前时间使用 jmap 生产 javadump文件 - 压缩 - 自动生成 scp 回传脚本 - 自动设置 crontab 为第二天早上 5:30 回传 javadump 文件到本地服务器</br>

# 注意事项</br>
javadump 文件需在 java 进程 jvm heap 较高的情况下生成才有分析意义；</br>
执行 jmap 可能会导致 java 进程短暂挂起，影响性能，需谨慎低频执行；</br>
远程服务器回传到本地服务器的 scp 需提前配置，脚本执行需有 scp_key ；</br>
jmap 的执行用户必须和 java 进程的执行用户相同，但与此同时一般用户通常没有 /var/spool/cron 的写入权限，脚本内部以设置用户转换，请以 root 用户执行本脚本。</br>

# 优化方向</br>
寻求对 java 进程性能影响较少的 jvm 内存监控方法，定时获取 jvm 实时使用内存。当 jvm 内存达到较高阈值时，触发钉钉告警并自动生成 javadump 文件闲时回传本地。</br>
